<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:th="http://www.thymeleaf.org">
    <head th:fragment="head">
        <title>Plantilla</title>
        <meta charset="UTF-8"/>
        <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}"/>
        <link rel="stylesheet" th:href="@{/webjars/font-awesome/css/all.css}"/>
        <script th:src="@{/webjars/jquery/jquery.min.js}"></script>
<!--        <script th:src="@{/webjars/popper.js/umd/popper.min.js}"></script>-->
        <script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>

        <link th:href="@{../css/toastr.min.css}" rel="stylesheet"/>
        <script th:src="@{../js/toastr.min.js}"></script>
    </head>
    <body>
        <header th:fragment="header">
            <nav class="navbar navbar-expand-lg">
                <div class="container-fluid">
                    <a class="navbar-brand" th:href="@{/}">
                        <i class="fas fa-light fa-ice-cream"></i> [[#{navbar.titulo}]]
                    </a>
                    <button aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#navbarSupportedContent" data-bs-toggle="collapse" type="button">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0" sec:authorize="isAuthenticated()">
                            <li class="nav-item">
                                <a class="nav-link" th:href="@{/vender/}">Vender</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" th:href="@{/clientesInicio}">Clientes</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" th:href="@{/productosInicio}">Productos</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" th:href="@{/ordenesInicio}">Ventas Realizadas</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" th:href="@{/cargasInicio}">Cargas</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" sec:authorize="hasRole('ROLE_ADMIN')" th:href="@{/reportesInicio}">[[#{ti.reportes}]]</a>
                            </li>
                        </ul>
                        <ul class="navbar-nav ml-auto" sec:authorize="isAuthenticated()">
                            <li>
                                <div class="btn-group" role="group" aria-label="Theme switcher">
                                    <button type="button" class="btn btn-light btn-sm" data-bs-theme-value="light">
                                        <i class="fas fa-sun"></i>
                                    </button>
                                    <button type="button" class="btn btn-dark btn-sm" data-bs-theme-value="dark">
                                        <i class="fas fa-moon"></i>
                                    </button>
                                </div>
                            </li>
                            <li class="nav-item mr-3">
                                <a class="nav-link" th:href="@{/usuario/?username=} + ${#authentication.name} + '&restablece=false&edit=true'">
                                    <i class="fas fa-user"></i>
                                    <span sec:authentication="name">Usuario</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <form method="POST" th:action="@{/logout}">
                                    <a class="nav-link" href="#" onclick="this.parentNode.submit();">
                                        <i class="fas fa-sign-out-alt"></i> [[#{navbar.salir}]]
                                    </a>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <footer class=" text-white mt-1 p-1" th:fragment="footer">
            <div class="container">
                <div class="col">
                    <p class="lead text-center">
                        <span> [[#{footer.pie-pagina}]] &reg;Hugo Lucero - Desarrollador Full-Stack</a></span>
                    </p>
                </div>
                <br/>
            </div>

            <script th:inline="javascript">
                /*<![CDATA[*/
                var type = /*[[${tipoAlerta}]]*/ ;
                var message = /*[[${mensajeAlerta}]]*/;
                /*]]>*/
                function hayAlerta() {
                    if(message != null && message.length > 0) {
                        let mess = type === 'error' || type === 'warning' ? setErrorMessages() : message;
                        switch (type) {
                            case "success":
                                toastr.success(mess);
                                break;
                            case "warning":
                                toastr.warning(mess);
                                break;
                            case "error":
                                toastr.error(mess);
                                break;
                        }
                    }
                }
                hayAlerta();

                function changeTheme() {

                }

                function setErrorMessages() {
                    let errorList = {
                        'usuario.mail': 'El mail ingresado ya existe',
                        'usuario.token': 'El token creado existe para otro usuario',
                        'TOKEN_NOT_EQUAL': 'El token ingresado no es correcto. Intente nuevamente.',
                        'USER_REPEATED': 'El nombre de usuario ingresado ya existe.',
                        'PASSWORD_NOT_1234': 'La contraseña no puede ser 1234, 1111, 1234567890, 0000',
                        'PASSWORD_NOT_REGEX': 'La contraseña debe tener al menos 8 caracteres, al menos una letra y un número',
                        'PASSWORD_NOT_LENGTH': 'La contraseña no puede ser menor a 8 caracteres',
                        'USER_INVALID': 'El usuario o contraseña son incorrectos.',
                        'LOGOUT': 'Has sido desconectado correctamente',
                        'PASSWORD_EQUAL': 'El password debe ser diferente al anterior',
                        'PASSWORD_EMPTY': 'El password no puede estar vacío',
                    }
                    for (let errorListKey in errorList) {
                        if(message.includes(errorListKey)){
                            return errorList[errorListKey];
                        }
                    }
                }

                (() => {
                    'use strict'

                    const getStoredTheme = () => localStorage.getItem('theme')
                    const setStoredTheme = theme => localStorage.setItem('theme', theme)

                    const getPreferredTheme = () => {
                        const storedTheme = getStoredTheme()
                        if (storedTheme) {
                            return storedTheme
                        }

                        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
                    }

                    const setTheme = theme => {
                        if (theme === 'auto') {
                            document.documentElement.setAttribute('data-bs-theme', (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'))
                        } else {
                            document.documentElement.setAttribute('data-bs-theme', theme)
                        }
                    }

                    setTheme(getPreferredTheme())

                    const showActiveTheme = (theme, focus = false) => {
                        const themeSwitcher = document.querySelector('#bd-theme')

                        if (!themeSwitcher) {
                            return
                        }

                        const themeSwitcherText = document.querySelector('#bd-theme-text')
                        const activeThemeIcon = document.querySelector('.theme-icon-active use')
                        const btnToActive = document.querySelector(`[data-bs-theme-value="${theme}"]`)
                        const svgOfActiveBtn = btnToActive.querySelector('svg use').getAttribute('href')

                        document.querySelectorAll('[data-bs-theme-value]').forEach(element => {
                            element.classList.remove('active')
                            element.setAttribute('aria-pressed', 'false')
                        })

                        btnToActive.classList.add('active')
                        btnToActive.setAttribute('aria-pressed', 'true')
                        activeThemeIcon.setAttribute('href', svgOfActiveBtn)
                        const themeSwitcherLabel = `${themeSwitcherText.textContent} (${btnToActive.dataset.bsThemeValue})`
                        themeSwitcher.setAttribute('aria-label', themeSwitcherLabel)

                        if (focus) {
                            themeSwitcher.focus()
                        }
                    }

                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                        const storedTheme = getStoredTheme()
                        if (storedTheme !== 'light' && storedTheme !== 'dark') {
                            setTheme(getPreferredTheme())
                        }
                    })

                    window.addEventListener('DOMContentLoaded', () => {
                        showActiveTheme(getPreferredTheme())

                        document.querySelectorAll('[data-bs-theme-value]')
                            .forEach(toggle => {
                                toggle.addEventListener('click', () => {
                                    const theme = toggle.getAttribute('data-bs-theme-value')
                                    setStoredTheme(theme)
                                    setTheme(theme)
                                    showActiveTheme(theme, true)
                                })
                            })
                    })
                })()

            </script>
        </footer>
    </body>
</html>
